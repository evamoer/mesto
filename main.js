(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n,r,o,i,a){var l=o.cardTemplateSelector,u=o.cardElementSelector,c=o.deleteCardButtonSelector,s=o.likeCardButtonSelector,f=o.activeLikeButtonClass,p=o.cardImageContainerSelector,d=o.cardImageSelector,h=o.cardTitleSelector,_=o.cardLikeNumberSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._item=e,this._userData=n,this._api=r,this._cardTemplateSelector=l,this._cardElementSelector=u,this._deleteCardButtonSelector=c,this._likeCardButtonSelector=s,this._activeLikeButtonClass=f,this._cardImageContainerSelector=p,this._cardImageSelector=d,this._cardTitleSelector=h,this._cardLikeNumberSelector=_,this._handleCardClick=i,this._handleDeleteClick=a}var n,r;return n=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardTemplateSelector).content.querySelector(this._cardElementSelector).cloneNode(!0)}},{key:"_deleteCard",value:function(){var e=this;this._handleDeleteClick(this._item._id).then((function(){return e._element.remove()}))}},{key:"_renderLike",value:function(e,t){var n=this._element.querySelector(this._cardLikeNumberSelector),r=this._element.querySelector(this._likeCardButtonSelector);n.textContent=e.likes.length,t?r.classList.remove(this._activeLikeButtonClass):r.classList.add(this._activeLikeButtonClass)}},{key:"_handleLikeClick",value:function(e){var t=this,n=e.target.classList.contains(this._activeLikeButtonClass);n?this._api.unlikeCard(this._item._id).then((function(e){return t._renderLike(e,n)})):this._api.likeCard(this._item._id).then((function(e){return t._renderLike(e,n)}))}},{key:"_setEventListeners",value:function(e,t,n){var r=this;n.addEventListener("click",this._handleCardClick),e.addEventListener("click",this._deleteCard.bind(this)),t.addEventListener("click",(function(e){return r._handleLikeClick(e)}))}},{key:"generateCard",value:function(){var e=this;this._element=this._getTemplate();var t=this._element.querySelector(this._cardImageSelector),n=this._element.querySelector(this._cardTitleSelector),r=this._element.querySelector(this._deleteCardButtonSelector),o=this._element.querySelector(this._likeCardButtonSelector),i=this._element.querySelector(this._cardImageContainerSelector);return t.src=this._item.link,t.alt=this._item.name,n.textContent=this._item.name,this._item.owner._id!==this._userData._id&&(r.style.visibility="hidden"),this._item.likes.length>0?this._item.likes.forEach((function(t){t._id===e._userData._id?e._renderLike(e._item,!1):e._renderLike(e._item,!0)})):this._renderLike(this._item,!0),this._setEventListeners(r,o,i),this._element}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){var r=t.inactiveButtonClass,o=t.inputErrorClass,i=t.errorClass,a=t.submitButtonSelector,l=t.inputSelector,u=t.closeButtonSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=n,this._inactiveButtonClass=r,this._inputErrorClass=o,this._errorClass=i,this._submitButtonElement=n.querySelector(a),this._inputList=Array.from(n.querySelectorAll(l)),this._closeButtonElement=n.closest(".popup__container").querySelector(u)}var t,r;return t=e,(r=[{key:"_defineErrorElement",value:function(e){return this._errorElement=this._formElement.querySelector("#".concat(e.name,"-input-error")),this._errorElement}},{key:"_hideInputError",value:function(e,t){(t=this._defineErrorElement(e)).textContent="",t.classList.remove(this._errorClass)}},{key:"_showInputError",value:function(e,t){(t=this._defineErrorElement(e)).textContent=e.validationMessage,t.classList.add(this._errorClass)}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"toggleSubmitButtonState",value:function(){this._hasInvalidInput()?(this._submitButtonElement.setAttribute("disabled",!0),this._submitButtonElement.classList.add(this._inactiveButtonClass)):(this._submitButtonElement.removeAttribute("disabled",!1),this._submitButtonElement.classList.remove(this._inactiveButtonClass))}},{key:"_toggleInputState",value:function(e){e.validity.valid?(e.classList.remove(this._inputErrorClass),this._hideInputError(e)):(e.classList.add(this._inputErrorClass),this._showInputError(e))}},{key:"cleanInputError",value:function(){var e=this;this._inputList.forEach((function(t){e._hideInputError(t),t.classList.remove(e._inputErrorClass)}))}},{key:"_setEventListeners",value:function(){var e=this;this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._toggleInputState(t),e.toggleSubmitButtonState()}))})),this.toggleSubmitButtonState()}},{key:"enableValidation",value:function(){this._setEventListeners()}}])&&n(t.prototype,r),e}();function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupElement=document.querySelector(t),this._closeButtonElement=this._popupElement.querySelector(".button_type_close"),this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"handleOverlayClick",value:function(e){e.target===e.currentTarget&&this.close()}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){this._closeButtonElement.addEventListener("click",this.close.bind(this)),this._popupElement.addEventListener("mousedown",this.handleOverlayClick.bind(this))}}])&&i(t.prototype,n),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(r);if(o){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return f(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._fullImageElement=t._popupElement.querySelector(".popup__full-image"),t._fullImageCaption=t._popupElement.querySelector(".popup__full-image-caption"),t}return t=a,(n=[{key:"open",value:function(e){c(p(a.prototype),"open",this).call(this),this._fullImageElement.src=e.target.src,this._fullImageElement.alt=e.target.alt,this._fullImageCaption.textContent=e.target.alt}}])&&u(t.prototype,n),a}(a);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(o){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return v(this,e)});function a(e){var t,n=e.popupSelector,r=e.formValidator,o=e.handleFormSubmit;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,n))._formValidator=r,t._handleFormSubmit=o,t._formElement=t._popupElement.querySelector(".popup__form"),t._submitButtonElement=t._formElement.querySelector(".button_type_submit"),t._inputList=t._formElement.querySelectorAll(".popup__input"),t}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.id]=t.value})),e}},{key:"setEventListeners",value:function(){var e=this;m(b(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){e._handleFormSubmit(t,e._getInputValues()),e.close()}))}},{key:"open",value:function(){this._formValidator.cleanInputError(),this._formValidator.toggleSubmitButtonState(),m(b(a.prototype),"open",this).call(this)}},{key:"close",value:function(){m(b(a.prototype),"close",this).call(this),this._formElement.reset()}},{key:"renderLoading",value:function(e){this._submitButtonElement.textContent=e?"Сохранение...":"Сохранить"}}])&&_(t.prototype,n),a}(a);function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(t){var n=t.profileNameElementSelector,r=t.profileAboutElementSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileNameElement=document.querySelector(n),this._profileAboutElement=document.querySelector(r)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{profileName:this._profileNameElement.textContent,profileAbout:this._profileAboutElement.textContent}}},{key:"setUserInfo",value:function(e){this._profileNameElement.textContent=e.name,this._profileAboutElement.textContent=e.about}}])&&S(t.prototype,n),e}();function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r}var t,n;return t=e,(n=[{key:"_responseHandler",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}},{key:"_errorChecker",value:function(e){console.log(e)}},{key:"receiveCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._responseHandler(t)})).catch((function(t){return e._errorHandler(t)}))}},{key:"getUserData",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(t){return e._responseHandler(t)})).catch((function(t){return e._errorHandler(t)}))}},{key:"updateUserData",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return t._responseHandler(e)})).catch((function(e){return t._errorHandler(e)}))}},{key:"addCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t._responseHandler(e)})).catch((function(e){return t._errorHandler(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._responseHandler(e)})).catch((function(e){return t._errorHandler(e)}))}},{key:"likeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._responseHandler(e)})).catch((function(e){return t._errorHandler(e)}))}},{key:"unlikeCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._responseHandler(e)})).catch((function(e){return t._errorHandler(e)}))}},{key:"updateAvatar",value:function(e){var t=this,n=e.avatar;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:n})}).then((function(e){return t._responseHandler(e)})).catch((function(e){return t._errorHandler(e)}))}}])&&g(t.prototype,n),e}(),L={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",openButtonSelector:".button_type_open",closeButtonSelector:".button_type_close",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},w={cardTemplateSelector:".gallery-item-template",cardElementSelector:".gallery-table__item",deleteCardButtonSelector:".button_type_delete-card",likeCardButtonSelector:".button_type_like",activeLikeButtonClass:"button_type_like-active",cardImageContainerSelector:".card__image-container",cardImageSelector:".card__image",cardTitleSelector:".card__title",cardLikeNumberSelector:".card__like-number"},B=document.querySelector(".button_type_edit"),O=document.querySelector(".button_type_add"),I=document.querySelector(".profile__avatar-container"),T=document.querySelector(".profile__avatar"),j=document.getElementById("popup__edit-profile-form"),q=j.elements["profile-name"],P=j.elements["profile-about"],U=document.getElementById("popup__edit-avatar-form"),D=document.getElementById("popup__add-card-form"),H=document.getElementById("popup__delete-card-form"),R=new r(L,j),A=new r(L,D),N=new r(L,H),x=new r(L,U),V=new d(".popup_type_full-image"),F=new k({profileNameElementSelector:".profile__name",profileAboutElementSelector:".profile__about"}),J=new C({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-27",headers:{authorization:"8db06075-d4ea-471e-8c36-db2b91e349e8","Content-Type":"application/json"}}),z=function(e){V.open(e)},M=function(e){return X.open(),new Promise((function(t,n){H.onsubmit=function(){t(J.deleteCard(e))}}))};J.getUserData().then((function(e){F.setUserInfo(e),T.src=e.avatar}));var G=new function e(t,n){var r=this,i=n.containerSelector,a=n.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"_render",(function(e,t){var n=r._renderer(e,t);r._container.prepend(n)})),o(this,"addItem",(function(e){r._api.addCard(e).then((function(e){r._api.getUserData().then((function(t){return r._render(e,t)}))}))})),o(this,"receiveItems",(function(){r._api.receiveCards().then((function(e){r._api.getUserData().then((function(t){e.reverse().forEach((function(e){return r._render(e,t)}))}))}))})),this._api=t,this._container=document.querySelector(i),this._renderer=a}(J,{containerSelector:".gallery-table",renderer:function(e,n){return new t(e,n,J,w,z,M).generateCard()}});G.receiveItems();var K=new E({popupSelector:".popup_type_edit-profile",formValidator:R,handleFormSubmit:function(e,t){e.preventDefault(),K.renderLoading(!0),J.updateUserData(t).then((function(e){F.setUserInfo(e)})).finally((function(){return K.renderLoading(!1)}))}}),Q=new E({popupSelector:".popup_type_add-card",formValidator:A,handleFormSubmit:function(e,t){e.preventDefault(),G.addItem(t)}}),W=new E({popupSelector:".popup_type_edit-avatar",formValidator:x,handleFormSubmit:function(e,t){e.preventDefault(),W.renderLoading(!0),J.updateAvatar(t).then((function(e){document.querySelector(".profile__avatar").src=e.avatar})).finally((function(){return W.renderLoading(!1)}))}}),X=new E({popupSelector:".popup_type_delete-card",formValidator:N,handleFormSubmit:function(e){e.preventDefault()}});B.addEventListener("click",(function(){var e=F.getUserInfo();q.value=e.profileName,P.value=e.profileAbout,K.open()})),O.addEventListener("click",Q.open.bind(Q)),I.addEventListener("click",W.open.bind(W)),Q.setEventListeners(),K.setEventListeners(),V.setEventListeners(),X.setEventListeners(),W.setEventListeners(),R.enableValidation(),A.enableValidation(),x.enableValidation()})();